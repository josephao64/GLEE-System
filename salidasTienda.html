<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Sistema de Ventas con Variantes y Comprobante Estrecho</title>
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Firebase (v8) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- jsPDF para generar el comprobante PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
      body {
        padding: 20px;
      }
      .card-product {
        margin-bottom: 15px;
      }
      .pointer {
        cursor: pointer;
      }
      .filter-input {
        margin-bottom: 10px;
      }
      .card-product .card-body {
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <!-- Lado Izquierdo: Carrito y Datos de Cliente/Pago -->
        <div class="col-md-5 border-end">
          <h2>Carrito de Venta</h2>
          <table class="table table-sm" id="cartTable">
            <thead>
              <tr>
                <th>Producto</th>
                <th>Variante</th>
                <th>Cant.</th>
                <th>Precio Unitario (Q)</th>
                <th>Subtotal (Q)</th>
                <th>Remover</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <h4>Total: Q <span id="totalVenta">0.00</span></h4>
          <button class="btn btn-primary mt-2" onclick="capturarDatosCliente()">Datos del Cliente</button>
          <button class="btn btn-success mt-2" onclick="procesarVenta()">Procesar Venta</button>
        </div>
        <!-- Lado Derecho: Productos Disponibles -->
        <div class="col-md-7">
          <h2>Productos Disponibles</h2>
          <!-- Filtros avanzados -->
          <div class="row">
            <div class="col-md-4">
              <input type="text" id="filterNombre" class="form-control filter-input" placeholder="Buscar por nombre o código">
            </div>
            <div class="col-md-3">
              <select id="filterCategoria" class="form-select filter-input">
                <option value="">Categoría</option>
              </select>
            </div>
            <div class="col-md-3">
              <select id="filterSubcategoria" class="form-select filter-input">
                <option value="">Subcategoría</option>
              </select>
            </div>
            <div class="col-md-2">
              <input type="number" id="filterPrecioMin" class="form-control filter-input" placeholder="Precio min">
            </div>
            <div class="col-md-2">
              <input type="number" id="filterPrecioMax" class="form-control filter-input" placeholder="Precio max">
            </div>
            <div class="col-md-2">
              <input type="number" id="filterStock" class="form-control filter-input" placeholder="Stock mínimo">
            </div>
          </div>
          <div id="productosContainer" class="row">
            <!-- Se mostrarán los productos en tarjetas -->
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Configuración de Firebase
      var firebaseConfig = {
        apiKey: "AIzaSyAjVTKBJwZ8qql32ZrZBy0Q1NFUYMu-Xzk",
        authDomain: "gleedb-5d36a.firebaseapp.com",
        projectId: "gleedb-5d36a",
        storageBucket: "gleedb-5d36a",
        messagingSenderId: "1090238022032",
        appId: "1:1090238022032:web:c637b0a6dfe06be5287315"
      };
      firebase.initializeApp(firebaseConfig);
      var db = firebase.firestore();

      // Variables globales
      let productos = [];
      let categorias = [];
      let cart = [];
      let datosCliente = {};

      // Usuario actual (ejemplo)
      const usuarioActual = "admin@tienda.com";

      // Función para autogenerar código (producto o variante)
      function generarCodigo(campo, prefijo = "") {
        if (!campo || campo.trim() === "") {
          return prefijo + Date.now() + "-" + Math.floor(Math.random() * 1000);
        }
        return campo.trim();
      }

      // Cargar Categorías y popular filtros
      async function loadCategorias() {
        const snapshot = await db.collection("categories").get();
        categorias = [];
        snapshot.forEach(doc => {
          let data = doc.data();
          data.id = doc.id;
          categorias.push(data);
        });
        populateFilters();
      }

      function populateFilters() {
        let filterCategoria = document.getElementById("filterCategoria");
        let filterSubcategoria = document.getElementById("filterSubcategoria");
        filterCategoria.innerHTML = `<option value="">Categoría</option>`;
        filterSubcategoria.innerHTML = `<option value="">Subcategoría</option>`;
        categorias.forEach(cat => {
          let option = document.createElement("option");
          option.value = cat.name;
          option.textContent = cat.name;
          filterCategoria.appendChild(option);
          if (cat.subcategorias) {
            cat.subcategorias.forEach(sub => {
              let opt = document.createElement("option");
              opt.value = sub;
              opt.textContent = sub;
              filterSubcategoria.appendChild(opt);
            });
          }
        });
      }

      // Cargar Productos
      async function loadProductos() {
        const snapshot = await db.collection("productos").get();
        productos = [];
        snapshot.forEach(doc => {
          let prod = doc.data();
          prod.id = doc.id;
          productos.push(prod);
        });
        renderProductos();
      }

      // Renderizar Productos en Tarjetas
      function renderProductos() {
        let container = document.getElementById("productosContainer");
        container.innerHTML = "";
        let nombreFilter = document.getElementById("filterNombre").value.toLowerCase();
        let catFilter = document.getElementById("filterCategoria").value;
        let subFilter = document.getElementById("filterSubcategoria").value;
        let precioMin = parseFloat(document.getElementById("filterPrecioMin").value) || 0;
        let precioMax = parseFloat(document.getElementById("filterPrecioMax").value) || Infinity;
        let stockMin = parseInt(document.getElementById("filterStock").value) || 0;
        let filtered = productos.filter(prod => {
          let matchNombre = prod.nombre.toLowerCase().includes(nombreFilter) || (prod.codigo || "").toLowerCase().includes(nombreFilter);
          let matchCat = !catFilter || prod.categoria === catFilter;
          let matchSub = !subFilter || prod.subcategoria === subFilter;
          let variantMatch = false;
          if (prod.variantes && prod.variantes.length > 0) {
            prod.variantes.forEach(variant => {
              if (variant.precio >= precioMin && variant.precio <= precioMax && variant.stock >= stockMin) {
                variantMatch = true;
              }
            });
          }
          return matchNombre && matchCat && matchSub && variantMatch;
        });
        filtered.forEach(prod => {
          let card = document.createElement("div");
          card.className = "col-md-6 mb-3";
          let imgTag = prod.imagen ? `<img src="${prod.imagen}" class="card-img-top" alt="${prod.nombre}" style="height:150px; object-fit:cover;">` : "";
          card.innerHTML = `
            <div class="card">
              ${imgTag}
              <div class="card-body">
                <h5 class="card-title">${prod.nombre} <small>${prod.codigo || "N/A"}</small></h5>
                <p class="card-text">
                  <strong>Categoría:</strong> ${prod.categoria}<br>
                  <strong>Subcategoría:</strong> ${prod.subcategoria}<br>
                  <strong>Stock Total:</strong> ${prod.stock_total || 0}
                </p>
                <button class="btn btn-primary btn-sm" onclick="seleccionarVarianteVenta('${prod.id}')">Agregar al Carrito</button>
              </div>
            </div>
          `;
          container.appendChild(card);
        });
      }

      // Seleccionar Variante para Venta (Modal)
      async function seleccionarVarianteVenta(productId) {
        const prod = productos.find(p => p.id === productId);
        if (!prod) return;
        let htmlContent = `
          <h4>${prod.nombre} <small>${prod.codigo || "N/A"}</small></h4>
          <input id="swal-search-var" class="swal2-input" placeholder="Buscar por color, talla, marca o stock...">
          <div style="max-height:300px; overflow-y:auto;">
            <table id="tablaVariantes" class="table table-bordered">
              <thead>
                <tr>
                  <th>Código</th>
                  <th>Color</th>
                  <th>Talla</th>
                  <th>Marca</th>
                  <th>Precio (Q)</th>
                  <th>Stock</th>
                  <th>Seleccionar</th>
                </tr>
              </thead>
              <tbody>`;
        prod.variantes.forEach((variant, index) => {
          htmlContent += `
            <tr>
              <td>${variant.codigo || "N/A"}</td>
              <td>${variant.color || "N/A"}</td>
              <td>${variant.talla || "N/A"}</td>
              <td>${variant.marca || "N/A"}</td>
              <td>${variant.precio ? "Q" + variant.precio.toFixed(2) : "N/A"}</td>
              <td>${variant.stock || 0}</td>
              <td>
                <button class="btn btn-sm btn-primary" data-index="${index}" data-variant='${JSON.stringify(variant)}'>
                  Seleccionar
                </button>
              </td>
            </tr>
          `;
        });
        htmlContent += `
              </tbody>
            </table>
          </div>
        `;
        await Swal.fire({
          title: "Seleccione una Variante",
          html: htmlContent,
          focusConfirm: false,
          showCancelButton: true,
          didOpen: () => {
            const inputSearch = document.getElementById("swal-search-var");
            inputSearch.addEventListener("input", () => {
              const filter = inputSearch.value.toLowerCase();
              const rows = document.querySelectorAll("#tablaVariantes tbody tr");
              rows.forEach(row => {
                row.style.display = row.textContent.toLowerCase().includes(filter) ? "" : "none";
              });
            });
            document.querySelectorAll("#tablaVariantes button").forEach(btn => {
              btn.addEventListener("click", () => {
                const variantData = JSON.parse(btn.getAttribute("data-variant"));
                const variantIndex = parseInt(btn.getAttribute("data-index"));
                Swal.close();
                agregarAlCarrito(prod, variantData, variantIndex);
              });
            });
          }
        });
      }

      // Agregar Producto al Carrito
      async function agregarAlCarrito(product, variant, variantIndex) {
        const { value: cantidad } = await Swal.fire({
          title: "Cantidad a Agregar",
          input: "number",
          inputLabel: `Ingrese la cantidad (Stock disponible: ${variant.stock})`,
          inputAttributes: {
            min: 1,
            max: variant.stock,
            step: 1
          },
          inputValidator: (value) => {
            if (!value || value <= 0) {
              return "Ingrese una cantidad válida";
            }
            if (value > variant.stock) {
              return "La cantidad excede el stock disponible";
            }
          }
        });
        if (cantidad) {
          let existing = cart.find(item =>
            item.productId === product.id && item.variantIndex === variantIndex
          );
          if (existing) {
            if (existing.cantidad + parseInt(cantidad) > variant.stock) {
              Swal.fire("Error", "La cantidad total excede el stock disponible", "error");
              return;
            }
            existing.cantidad += parseInt(cantidad);
          } else {
            cart.push({
              productId: product.id,
              producto: product.nombre,
              producto_codigo: product.codigo || "N/A",
              variantIndex: variantIndex,
              variante: {
                codigo: variant.codigo || "N/A",
                color: variant.color,
                talla: variant.talla,
                marca: variant.marca,
                precio: variant.precio
              },
              cantidad: parseInt(cantidad)
            });
          }
          Swal.fire("Producto agregado al carrito", "", "success");
          renderCart();
        }
      }

      // Renderizar Carrito
      function renderCart() {
        let tbody = document.querySelector("#cartTable tbody");
        tbody.innerHTML = "";
        let total = 0;
        cart.forEach((item, index) => {
          let subtotal = item.cantidad * item.variante.precio;
          total += subtotal;
          let tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${item.producto} <br><small>${item.producto_codigo}</small></td>
            <td>
              Código: ${item.variante.codigo} <br>
              Color: ${item.variante.color} <br>
              Talla: ${item.variante.talla} <br>
              Marca: ${item.variante.marca}
            </td>
            <td>${item.cantidad}</td>
            <td>${item.variante.precio ? "Q" + item.variante.precio.toFixed(2) : "N/A"}</td>
            <td>${item.variante.precio ? "Q" + subtotal.toFixed(2) : "N/A"}</td>
            <td>
              <button class="btn btn-danger btn-sm" onclick="removerDelCarrito(${index})">❌</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
        document.getElementById("totalVenta").textContent = total.toFixed(2);
      }

      // Remover del Carrito
      function removerDelCarrito(index) {
        cart.splice(index, 1);
        renderCart();
      }

      // Capturar Datos del Cliente
      async function capturarDatosCliente() {
        const { value: cliente } = await Swal.fire({
          title: "Datos del Cliente",
          html: `
            <input type="text" id="clienteNombre" class="swal2-input" placeholder="Nombre y Apellido">
            <input type="text" id="clienteTelefono" class="swal2-input" placeholder="Teléfono">
            <input type="email" id="clienteCorreo" class="swal2-input" placeholder="Correo Electrónico (opcional)">
            <input type="text" id="clienteDireccion" class="swal2-input" placeholder="Dirección (opcional)">
          `,
          focusConfirm: false,
          preConfirm: () => {
            const nombre = document.getElementById("clienteNombre").value;
            const telefono = document.getElementById("clienteTelefono").value;
            if (!nombre || !telefono) {
              Swal.showValidationMessage("Nombre y Teléfono son obligatorios");
              return;
            }
            return {
              nombre,
              telefono,
              correo: document.getElementById("clienteCorreo").value,
              direccion: document.getElementById("clienteDireccion").value
            };
          }
        });
        if (cliente) {
          datosCliente = cliente;
          Swal.fire("Datos del cliente guardados", "", "success");
        }
      }

      // Procesar Venta y Descargar Comprobante
      async function procesarVenta() {
        if (cart.length === 0) {
          Swal.fire("El carrito está vacío", "", "warning");
          return;
        }
        if (!datosCliente.nombre || !datosCliente.telefono) {
          Swal.fire("Debe capturar los datos del cliente", "", "warning");
          return;
        }
        let resumen = "";
        cart.forEach(item => {
          resumen += `
            <p>
              <strong>${item.producto}</strong> (${item.producto_codigo})<br>
              Variante: ${item.variante.codigo} - ${item.variante.color} / ${item.variante.talla} / ${item.variante.marca}<br>
              Cantidad: ${item.cantidad} x Q${item.variante.precio.toFixed(2)} = Q${(item.cantidad * item.variante.precio).toFixed(2)}
            </p>
          `;
        });
        let totalVenta = parseFloat(document.getElementById("totalVenta").textContent) || 0;
        resumen += `<h4>Total: Q${totalVenta.toFixed(2)}</h4>`;
        const { value: pago } = await Swal.fire({
          title: "Procesar Venta",
          html: `
            ${resumen}
            <select id="metodoPago" class="swal2-select">
              <option value="Efectivo" selected>Efectivo</option>
              <option value="Tarjeta">Tarjeta</option>
            </select>
            <div id="pagoEfectivoContainer">
              <input type="number" id="montoRecibido" class="swal2-input" value="${totalVenta}" placeholder="Monto recibido (Q)">
            </div>
          `,
          focusConfirm: false,
          preConfirm: () => {
            const metodo = document.getElementById("metodoPago").value;
            let pagoObj = { metodo: metodo };
            if (metodo === "Efectivo") {
              let monto = parseFloat(document.getElementById("montoRecibido").value);
              if (isNaN(monto) || monto < totalVenta) {
                Swal.showValidationMessage("Monto insuficiente para cubrir el total");
                return;
              }
              pagoObj.montoRecibido = monto;
              pagoObj.cambio = monto - totalVenta;
            }
            return pagoObj;
          },
          didOpen: () => {
            const metodoSelect = document.getElementById("metodoPago");
            const pagoContainer = document.getElementById("pagoEfectivoContainer");
            if (metodoSelect.value === "Efectivo") {
              pagoContainer.style.display = "block";
            }
            metodoSelect.addEventListener("change", function() {
              if (this.value === "Efectivo") {
                pagoContainer.style.display = "block";
              } else {
                pagoContainer.style.display = "none";
              }
            });
          }
        });
        if (!pago) return;
        let venta = {
          fecha: new Date().toISOString(),
          cliente: datosCliente,
          productos: cart.map(item => ({
            producto_id: item.productId,
            producto_nombre: item.producto,
            producto_codigo: item.producto_codigo,
            variante: item.variante,
            cantidad: item.cantidad,
            precio_unitario: item.variante.precio,
            subtotal: item.cantidad * item.variante.precio
          })),
          total: totalVenta,
          metodo_pago: pago.metodo,
          cambio: pago.cambio || 0,
          usuario: usuarioActual
        };

        // Actualizar stock en productos usando batch
        let batch = db.batch();
        for (let item of cart) {
          let prodRef = db.collection("productos").doc(item.productId);
          let prodDoc = await prodRef.get();
          if (prodDoc.exists) {
            let prodData = prodDoc.data();
            let variantes = prodData.variantes;
            if (variantes && variantes[item.variantIndex] !== undefined) {
              variantes[item.variantIndex].stock -= item.cantidad;
              batch.update(prodRef, { variantes: variantes });
            }
          }
        }
        let ventaRef = db.collection("ventas").doc();
        batch.set(ventaRef, venta);
        batch.commit().then(() => {
          Swal.fire({
            title: "Venta procesada!",
            html: "Comprobante generado.<br><button class='btn btn-primary' onclick='descargarComprobante(" + JSON.stringify(venta) + ")'>Descargar Comprobante</button>",
            icon: "success"
          });
          cart = [];
          renderCart();
        }).catch(error => {
          Swal.fire("Error", error.toString(), "error");
        });
      }

      // Función: Descargar Comprobante (PDF) con Formato Estrecho (Ticket)
      function descargarComprobante(venta) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF({
          orientation: 'p',
          unit: 'mm',
          format: [80, 300]
        });
        const pageWidth = doc.internal.pageSize.getWidth();
        const pageHeight = doc.internal.pageSize.getHeight();
        let xMargin = 5;
        let y = 10;
        
        // Paleta de colores y estilos
        const colorPrimario = [60, 60, 60];
        const colorLineas   = [200, 200, 200];
        const colorSeccion  = [230, 230, 240];
        
        // TÍTULO PRINCIPAL
        doc.setFont("helvetica", "bold");
        doc.setFontSize(12);
        doc.text("COMPROBANTE DE VENTA", pageWidth / 2, y, { align: "center" });
        y += 6;
        doc.setLineWidth(0.3);
        doc.setDrawColor(...colorLineas);
        doc.line(xMargin, y, pageWidth - xMargin, y);
        y += 4;
        
        // DATOS DEL CLIENTE
        doc.setFont("helvetica", "bold");
        doc.setFontSize(10);
        doc.setFillColor(...colorSeccion);
        doc.rect(xMargin, y - 3, pageWidth - xMargin * 2, 6, "F");
        doc.text("Datos del Cliente", xMargin + 1, y);
        y += 6;
        doc.setFont("helvetica", "normal");
        doc.setFontSize(9);
        doc.text("Fecha: " + new Date(venta.fecha).toLocaleString(), xMargin, y);
        y += 5;
        doc.text("Nombre: " + (venta.cliente.nombre || ""), xMargin, y);
        y += 5;
        doc.text("Tel: " + (venta.cliente.telefono || ""), xMargin, y);
        y += 5;
        if (venta.cliente.correo) {
          doc.text("Correo: " + venta.cliente.correo, xMargin, y);
          y += 5;
        }
        if (venta.cliente.direccion) {
          doc.text("Dir: " + venta.cliente.direccion, xMargin, y);
          y += 5;
        }
        y += 2;
        doc.line(xMargin, y, pageWidth - xMargin, y);
        y += 4;
        
        // DETALLE DE PRODUCTOS
        doc.setFont("helvetica", "bold");
        doc.setFillColor(...colorSeccion);
        doc.rect(xMargin, y - 3, pageWidth - xMargin * 2, 6, "F");
        doc.text("Productos", xMargin + 1, y);
        y += 6;
        doc.setFont("helvetica", "normal");
        doc.setFontSize(9);
        // Encabezado de la mini-tabla
        doc.setFont("helvetica", "bold");
        doc.text("Desc.", xMargin, y);
        doc.text("Cant", pageWidth - xMargin - 30, y, { align: "right" });
        doc.text("P.U.", pageWidth - xMargin - 18, y, { align: "right" });
        doc.text("Subt.", pageWidth - xMargin, y, { align: "right" });
        y += 4;
        doc.setDrawColor(...colorLineas);
        doc.line(xMargin, y, pageWidth - xMargin, y);
        y += 3;
        doc.setFont("helvetica", "normal");
        venta.productos.forEach((prod, index) => {
          const precio_unitario = prod.precio_unitario !== undefined ? prod.precio_unitario : 0;
          const subtotal = prod.subtotal !== undefined ? prod.subtotal : 0;
          let nombre = prod.producto_nombre || "";
          if(nombre.length > 20) { nombre = nombre.substring(0,20) + "..."; }
          doc.text(`${index+1}. ${nombre}`, xMargin, y);
          y += 4;
          if (prod.variante) {
            let varTexto = (prod.variante.codigo || "N/A") + " - " + (prod.variante.color || "") + " / " + (prod.variante.talla || "");
            doc.setFontSize(8);
            doc.text(varTexto, xMargin, y);
            doc.setFontSize(9);
            y += 4;
          }
          // Alinear cantidad, precio unitario y subtotal a la derecha
          doc.text(String(prod.cantidad), pageWidth - xMargin - 30, y - 2, { align: "right" });
          doc.text("Q" + precio_unitario.toFixed(2), pageWidth - xMargin - 18, y - 2, { align: "right" });
          doc.text("Q" + subtotal.toFixed(2), pageWidth - xMargin, y - 2, { align: "right" });
          y += 6;
          if (y > 240) {
            doc.addPage();
            y = 10;
          }
        });
        
        y += 3;
        doc.line(xMargin, y, pageWidth - xMargin, y);
        y += 5;
        
        // RESUMEN DE VENTA (alineado a la derecha)
        doc.setFont("helvetica", "bold");
        doc.setFillColor(...colorSeccion);
        doc.rect(xMargin, y - 3, pageWidth - xMargin * 2, 6, "F");
        doc.text("Resumen", xMargin + 1, y);
        y += 6;
        doc.setFont("helvetica", "normal");
        doc.text("Subtotal:", pageWidth - xMargin - 20, y, { align: "right" });
        doc.text("Q" + venta.total.toFixed(2), pageWidth - xMargin, y, { align: "right" });
        y += 5;
        let impuestos = 0; // Ajusta según sea necesario
        doc.text("Impuestos:", pageWidth - xMargin - 20, y, { align: "right" });
        doc.text("Q" + impuestos.toFixed(2), pageWidth - xMargin, y, { align: "right" });
        y += 5;
        let totalPagar = venta.total + impuestos;
        doc.setFont("helvetica", "bold");
        doc.text("Total:", pageWidth - xMargin - 20, y, { align: "right" });
        doc.text("Q" + totalPagar.toFixed(2), pageWidth - xMargin, y, { align: "right" });
        doc.setFont("helvetica", "normal");
        y += 7;
        doc.text("Método de Pago: " + venta.metodo_pago, xMargin, y);
        if (venta.metodo_pago === "Efectivo") {
          y += 6;
          doc.text("Recibido: Q" + (venta.montoRecibido !== undefined ? venta.montoRecibido.toFixed(2) : "0.00"), xMargin, y);
          y += 6;
          doc.text("Cambio: Q" + (venta.cambio !== undefined ? venta.cambio.toFixed(2) : "0.00"), xMargin, y);
        }
        y += 10;
        doc.setFont("helvetica", "italic");
        doc.text("¡Gracias por su compra!", pageWidth / 2, y, { align: "center" });
        
        // Dibujar borde final (estilo ticket)
        doc.setLineWidth(0.5);
        doc.rect(xMargin, 8, pageWidth - xMargin * 2, y + 5);
        
        doc.save("comprobante_venta_estrecho.pdf");
      }

      // Inicializar el sistema de venta
      async function initSistemaVenta() {
        await loadCategorias();
        await loadProductos();
      }
      initSistemaVenta();

      // Eventos de filtros
      document.getElementById("filterNombre").addEventListener("input", renderProductos);
      document.getElementById("filterCategoria").addEventListener("change", renderProductos);
      document.getElementById("filterSubcategoria").addEventListener("change", renderProductos);
      document.getElementById("filterPrecioMin").addEventListener("input", renderProductos);
      document.getElementById("filterPrecioMax").addEventListener("input", renderProductos);
      document.getElementById("filterStock").addEventListener("input", renderProductos);
    </script>
  </body>
</html>
